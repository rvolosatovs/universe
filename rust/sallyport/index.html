<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API for the hypervisor-microkernel boundary"><meta name="keywords" content="rust, rustlang, rust-lang, sallyport"><title>sallyport - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../sallyport/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.png" alt="logo"></div>
        </a><h2 class="location">Crate sallyport</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.3.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all sallyport's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#constants">Constants</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="sallyport" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../sallyport/index.html"><img class="rust-logo" src="../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">sallyport</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/sallyport/lib.rs.html#3-132" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>API for the hypervisor-microkernel boundary</p>
<p><code>sallyport</code> is a protocol crate for proxying service requests (such as syscalls) from an Enarx Keep
to the host. A <a href="https://en.wikipedia.org/wiki/Sally_port">sally port</a> is a secure gateway through
which a defending army might “sally forth” from the protection of their fortification.</p>
<h2 id="mechanism-of-action" class="section-header"><a href="#mechanism-of-action">Mechanism of action</a></h2>
<p><code>sallyport</code> works by providing the host with the most minimal register context it requires to
perform the syscall on the Keep’s behalf. In doing so, the host can immediately call the desired
syscall without any additional logic required.</p>
<p>Guest and host side communicate via a mutually-distrusted shared block of memory.</p>
<p>This crate provides functionality for the guest to execute arbitary requests by proxying requests to the host via
the untrusted block and corresponding functionality for the host to execute the requests contained within the untrusted block.</p>
<h2 id="block-format" class="section-header"><a href="#block-format">Block format</a></h2>
<p>The sallyport <a href="item/struct.Block.html">block</a> is a region of memory containing zero or more <a href="item/enum.Item.html">items</a>.
All items contain the following <a href="item/struct.Header.html">header</a>:</p>
<ul>
<li>size: <code>usize</code></li>
<li>kind: <code>usize</code></li>
</ul>
<p>The size parameter includes the full length of the item except the header value. The contents of the item are defined by the value of the <a href="item/enum.Kind.html"><code>kind</code></a> parameter. An item with an unknown <a href="item/enum.Kind.html"><code>kind</code></a> can be skipped since the length of the item is known from the <code>size</code> field. The recipient of an item with an unknown <a href="item/enum.Kind.html"><code>kind</code></a> MUST NOT try to interpret or modify the contents of the item in any way.</p>
<h3 id="kinds" class="section-header"><a href="#kinds">Kinds</a></h3>
<ul>
<li><code>END</code>: <code>0</code></li>
<li><code>SYSCALL</code>: <code>1</code></li>
<li>…</li>
</ul>
<h4 id="end" class="section-header"><a href="#end">End</a></h4>
<p>An <a href="item/enum.Kind.html#variant.End"><code>END</code></a> item MUST have a <code>size</code> of <code>0</code>. It has no contents and simply marks the end of items in the block. This communicates the end of the items list to the host. However, the guest MUST NOT rely on the presence of a terminator upon return to the guest.</p>
<h4 id="syscall" class="section-header"><a href="#syscall">Syscall</a></h4>
<p>A <code>SYSCALL</code> item has the following contents:</p>
<ul>
<li><code>nmbr</code>: <code>usize</code> - the syscall number</li>
<li><code>arg0</code>: <code>usize</code> - the first argument</li>
<li><code>arg1</code>: <code>usize</code> - the second argument</li>
<li><code>arg2</code>: <code>usize</code> - the third argument</li>
<li><code>arg3</code>: <code>usize</code> - the fourth argument</li>
<li><code>arg4</code>: <code>usize</code> - the fifth argument</li>
<li><code>arg5</code>: <code>usize</code> - the sixth argument</li>
<li><code>ret0</code>: <code>usize</code> - the first return value</li>
<li><code>ret1</code>: <code>usize</code> - the second return value</li>
<li><code>data</code>: <code>...</code> - data that can be referenced (optional)</li>
</ul>
<p>The argument values may contain numeric values. However, all pointers MUST be translated to an offset from the beginning of the data section.</p>
<h3 id="example" class="section-header"><a href="#example">Example</a></h3>
<p>Here’s an example of how the <code>sallyport</code> protocol might be used to proxy a syscall between
the host and a protected virtual machine:</p>
<ol>
<li>The workload within the Keep makes a <code>write</code> syscall.</li>
<li>The shim traps all syscalls, and notices this is a <code>write</code> syscall.</li>
<li>The shim allocates space for an <a href="item/struct.Header.html">item header</a>, syscall number, six arguments, two return values, as many bytes that the workload wants to write as fits in the block and an <a href="item/enum.Kind.html#variant.End"><code>END</code></a> <a href="item/struct.Header.html">item header</a>.</li>
<li>The shim writes the <a href="item/struct.Header.html">item header</a>, argument values and copies the bytes that the workload wants to write onto the data region of the block. It is now accessible to the host.</li>
<li>The shim writes to the allocated section. In the case of the <code>write</code> syscall, the shim:
<ol>
<li>Writes the <a href="item/struct.Header.html">item header</a> with item <code>kind</code> set to <a href="item/enum.Kind.html#variant.Syscall"><code>Syscall</code></a> and size equal to 9 + count of allocated bytes to write (syscall number + arguments + return values + data length).</li>
<li>Writes the request <code>nmbr</code> equal to the Linux integral value for <a href="../libc/unix/linux_like/linux/gnu/b64/x86_64/not_x32/constant.SYS_write.html"><code>SYS_write</code></a>.</li>
<li>Writes the syscall arguments and return values:
<ol>
<li><code>arg0</code> = The file descriptor to write to.</li>
<li><code>arg1</code> = The offset starting after the last return value where the bytes have been copied to.</li>
<li><code>arg2</code> = The number of bytes that the <code>write</code> syscall should emit from the bytes pointed to in the second parameter.</li>
<li><code>arg3</code> = <a href="constant.NULL.html" title="NULL"><code>NULL</code></a></li>
<li><code>arg4</code> = <a href="constant.NULL.html" title="NULL"><code>NULL</code></a></li>
<li><code>arg5</code> = <a href="constant.NULL.html" title="NULL"><code>NULL</code></a></li>
<li><code>ret0</code> = <a href="../libc/unix/linux_like/linux/gnu/b64/x86_64/constant.ENOSYS.html"><code>-ENOSYS</code></a></li>
<li><code>ret1</code> = <code>0</code></li>
</ol>
</li>
<li>Copies the bytes to write into the allocated section.</li>
</ol>
</li>
<li>The shim yields control to the untrusted host, in which host-side Enarx code realizes it must proxy a syscall.</li>
<li>The host-side Enarx code can invoke the syscall immediately using the values in the block.</li>
<li>Once the syscall is complete, the host-side Enarx code can update the syscall return value section write the syscall return code to it.</li>
<li>The host-side Enarx code returns control to the shim.</li>
<li>The shim examines the block and propagates any mutated data back to the protected address space. It may then return control to its workload.</li>
</ol>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="elf/index.html" title="sallyport::elf mod">elf</a></div><div class="item-right docblock-short"><p>Defines constants for use in ELF parsing</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="guest/index.html" title="sallyport::guest mod">guest</a></div><div class="item-right docblock-short"><p>Guest entrypoint into the sallyport.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="host/index.html" title="sallyport::host mod">host</a></div><div class="item-right docblock-short"><p>Host-specific functionality.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="item/index.html" title="sallyport::item mod">item</a></div><div class="item-right docblock-short"><p>Shared <code>sallyport</code> item definitions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="util/index.html" title="sallyport::util mod">util</a></div><div class="item-right docblock-short"><p>Utilities</p>
</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KVM_SYSCALL_TRIGGER_PORT.html" title="sallyport::KVM_SYSCALL_TRIGGER_PORT constant">KVM_SYSCALL_TRIGGER_PORT</a></div><div class="item-right docblock-short"><p>I/O port used to trigger an exit to the host (<code>#VMEXIT</code>) for KVM driven shims.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.NULL.html" title="sallyport::NULL constant">NULL</a></div><div class="item-right docblock-short"><p>Internal representation of a null pointer or <a href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html#variant.None" title="Option::None"><code>Option::None</code></a> value in the sallyport block.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.REQUIRES.html" title="sallyport::REQUIRES constant">REQUIRES</a></div><div class="item-right docblock-short"><p>The sallyport version requires</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.VERSION.html" title="sallyport::VERSION constant">VERSION</a></div><div class="item-right docblock-short"><p>The sallyport version</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Error.html" title="sallyport::Error type">Error</a></div><div class="item-right docblock-short"><p>Error type used within this crate.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Result.html" title="sallyport::Result type">Result</a></div><div class="item-right docblock-short"><p>Result type returned by functionality exposed by this crate.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="sallyport" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0-nightly (34926f0a1 2021-12-22)" ></div>
</body></html>